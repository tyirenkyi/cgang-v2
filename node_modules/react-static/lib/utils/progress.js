"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _progress = _interopRequireDefault(require("progress"));

var _default = function _default(total, label, options) {
  if (!options) {
    options = {};
  }

  if (!options.format) {
    options.format = "".concat(label ? "".concat(label, " ") : '', "[:bar] :current/:total :percent :rate/s :etas ");
  }

  var stream = options.stream || process.stderr;

  if (stream.isTTY && !options.forceNonTTY) {
    options.total = total;
    return new _progress["default"](options.format, options);
  }

  var curr = 0;
  var percent = 0;
  var start = new Date();
  return {
    tick: function tick() {
      curr += 1;
      var ratio = Math.min(Math.max(curr / total, 0), 1);
      var value = Math.floor(ratio * 100);

      if (value >= percent + 5) {
        percent = value;
        var elapsed = new Date() - start;
        var eta = percent === 100 ? 0 : elapsed * (total / curr - 1);
        var rate = curr / (elapsed / 1000);
        stream.write("".concat(options.format.replace('[:bar] ', '').replace('[:bar]', '').replace(':current', curr).replace(':total', total).replace(':elapsed', Number.isNaN(elapsed) ? '0.0' : (elapsed / 1000).toFixed(1)).replace(':eta', Number.isNaN(eta) || !Number.isFinite(eta) ? '0.0' : (eta / 1000).toFixed(1)).replace(':percent', "".concat(percent.toFixed(0), "%")).replace(':rate', Math.round(rate)), "\n"));
      }
    }
  };
};

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9wcm9ncmVzcy5qcyJdLCJuYW1lcyI6WyJ0b3RhbCIsImxhYmVsIiwib3B0aW9ucyIsImZvcm1hdCIsInN0cmVhbSIsInByb2Nlc3MiLCJzdGRlcnIiLCJpc1RUWSIsImZvcmNlTm9uVFRZIiwiUHJvZ3Jlc3MiLCJjdXJyIiwicGVyY2VudCIsInN0YXJ0IiwiRGF0ZSIsInRpY2siLCJyYXRpbyIsIk1hdGgiLCJtaW4iLCJtYXgiLCJ2YWx1ZSIsImZsb29yIiwiZWxhcHNlZCIsImV0YSIsInJhdGUiLCJ3cml0ZSIsInJlcGxhY2UiLCJOdW1iZXIiLCJpc05hTiIsInRvRml4ZWQiLCJpc0Zpbml0ZSIsInJvdW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7ZUFFZSxrQkFBQ0EsS0FBRCxFQUFRQyxLQUFSLEVBQWVDLE9BQWYsRUFBMkI7QUFDeEMsTUFBSSxDQUFDQSxPQUFMLEVBQWM7QUFDWkEsSUFBQUEsT0FBTyxHQUFHLEVBQVY7QUFDRDs7QUFDRCxNQUFJLENBQUNBLE9BQU8sQ0FBQ0MsTUFBYixFQUFxQjtBQUNuQkQsSUFBQUEsT0FBTyxDQUFDQyxNQUFSLGFBQ0VGLEtBQUssYUFBTUEsS0FBTixTQUFpQixFQUR4QjtBQUdEOztBQUNELE1BQU1HLE1BQU0sR0FBR0YsT0FBTyxDQUFDRSxNQUFSLElBQWtCQyxPQUFPLENBQUNDLE1BQXpDOztBQUNBLE1BQUlGLE1BQU0sQ0FBQ0csS0FBUCxJQUFnQixDQUFDTCxPQUFPLENBQUNNLFdBQTdCLEVBQTBDO0FBQ3hDTixJQUFBQSxPQUFPLENBQUNGLEtBQVIsR0FBZ0JBLEtBQWhCO0FBQ0EsV0FBTyxJQUFJUyxvQkFBSixDQUFhUCxPQUFPLENBQUNDLE1BQXJCLEVBQTZCRCxPQUE3QixDQUFQO0FBQ0Q7O0FBQ0QsTUFBSVEsSUFBSSxHQUFHLENBQVg7QUFDQSxNQUFJQyxPQUFPLEdBQUcsQ0FBZDtBQUNBLE1BQU1DLEtBQUssR0FBRyxJQUFJQyxJQUFKLEVBQWQ7QUFDQSxTQUFPO0FBQ0xDLElBQUFBLElBQUksRUFBRSxnQkFBTTtBQUNWSixNQUFBQSxJQUFJLElBQUksQ0FBUjtBQUNBLFVBQU1LLEtBQUssR0FBR0MsSUFBSSxDQUFDQyxHQUFMLENBQVNELElBQUksQ0FBQ0UsR0FBTCxDQUFTUixJQUFJLEdBQUdWLEtBQWhCLEVBQXVCLENBQXZCLENBQVQsRUFBb0MsQ0FBcEMsQ0FBZDtBQUNBLFVBQU1tQixLQUFLLEdBQUdILElBQUksQ0FBQ0ksS0FBTCxDQUFXTCxLQUFLLEdBQUcsR0FBbkIsQ0FBZDs7QUFFQSxVQUFJSSxLQUFLLElBQUlSLE9BQU8sR0FBRyxDQUF2QixFQUEwQjtBQUN4QkEsUUFBQUEsT0FBTyxHQUFHUSxLQUFWO0FBQ0EsWUFBTUUsT0FBTyxHQUFHLElBQUlSLElBQUosS0FBYUQsS0FBN0I7QUFDQSxZQUFNVSxHQUFHLEdBQUdYLE9BQU8sS0FBSyxHQUFaLEdBQWtCLENBQWxCLEdBQXNCVSxPQUFPLElBQUlyQixLQUFLLEdBQUdVLElBQVIsR0FBZSxDQUFuQixDQUF6QztBQUNBLFlBQU1hLElBQUksR0FBR2IsSUFBSSxJQUFJVyxPQUFPLEdBQUcsSUFBZCxDQUFqQjtBQUNBakIsUUFBQUEsTUFBTSxDQUFDb0IsS0FBUCxXQUNLdEIsT0FBTyxDQUFDQyxNQUFSLENBQ0FzQixPQURBLENBQ1EsU0FEUixFQUNtQixFQURuQixFQUVBQSxPQUZBLENBRVEsUUFGUixFQUVrQixFQUZsQixFQUdBQSxPQUhBLENBR1EsVUFIUixFQUdvQmYsSUFIcEIsRUFJQWUsT0FKQSxDQUlRLFFBSlIsRUFJa0J6QixLQUpsQixFQUtBeUIsT0FMQSxDQU1DLFVBTkQsRUFPQ0MsTUFBTSxDQUFDQyxLQUFQLENBQWFOLE9BQWIsSUFBd0IsS0FBeEIsR0FBZ0MsQ0FBQ0EsT0FBTyxHQUFHLElBQVgsRUFBaUJPLE9BQWpCLENBQXlCLENBQXpCLENBUGpDLEVBU0FILE9BVEEsQ0FVQyxNQVZELEVBV0NDLE1BQU0sQ0FBQ0MsS0FBUCxDQUFhTCxHQUFiLEtBQXFCLENBQUNJLE1BQU0sQ0FBQ0csUUFBUCxDQUFnQlAsR0FBaEIsQ0FBdEIsR0FDSSxLQURKLEdBRUksQ0FBQ0EsR0FBRyxHQUFHLElBQVAsRUFBYU0sT0FBYixDQUFxQixDQUFyQixDQWJMLEVBZUFILE9BZkEsQ0FlUSxVQWZSLFlBZXVCZCxPQUFPLENBQUNpQixPQUFSLENBQWdCLENBQWhCLENBZnZCLFFBZ0JBSCxPQWhCQSxDQWdCUSxPQWhCUixFQWdCaUJULElBQUksQ0FBQ2MsS0FBTCxDQUFXUCxJQUFYLENBaEJqQixDQURMO0FBbUJEO0FBQ0Y7QUEvQkksR0FBUDtBQWlDRCxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFByb2dyZXNzIGZyb20gJ3Byb2dyZXNzJ1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgKHRvdGFsLCBsYWJlbCwgb3B0aW9ucykgPT4ge1xyXG4gIGlmICghb3B0aW9ucykge1xyXG4gICAgb3B0aW9ucyA9IHt9XHJcbiAgfVxyXG4gIGlmICghb3B0aW9ucy5mb3JtYXQpIHtcclxuICAgIG9wdGlvbnMuZm9ybWF0ID0gYCR7XHJcbiAgICAgIGxhYmVsID8gYCR7bGFiZWx9IGAgOiAnJ1xyXG4gICAgfVs6YmFyXSA6Y3VycmVudC86dG90YWwgOnBlcmNlbnQgOnJhdGUvcyA6ZXRhcyBgXHJcbiAgfVxyXG4gIGNvbnN0IHN0cmVhbSA9IG9wdGlvbnMuc3RyZWFtIHx8IHByb2Nlc3Muc3RkZXJyXHJcbiAgaWYgKHN0cmVhbS5pc1RUWSAmJiAhb3B0aW9ucy5mb3JjZU5vblRUWSkge1xyXG4gICAgb3B0aW9ucy50b3RhbCA9IHRvdGFsXHJcbiAgICByZXR1cm4gbmV3IFByb2dyZXNzKG9wdGlvbnMuZm9ybWF0LCBvcHRpb25zKVxyXG4gIH1cclxuICBsZXQgY3VyciA9IDBcclxuICBsZXQgcGVyY2VudCA9IDBcclxuICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKClcclxuICByZXR1cm4ge1xyXG4gICAgdGljazogKCkgPT4ge1xyXG4gICAgICBjdXJyICs9IDFcclxuICAgICAgY29uc3QgcmF0aW8gPSBNYXRoLm1pbihNYXRoLm1heChjdXJyIC8gdG90YWwsIDApLCAxKVxyXG4gICAgICBjb25zdCB2YWx1ZSA9IE1hdGguZmxvb3IocmF0aW8gKiAxMDApXHJcblxyXG4gICAgICBpZiAodmFsdWUgPj0gcGVyY2VudCArIDUpIHtcclxuICAgICAgICBwZXJjZW50ID0gdmFsdWVcclxuICAgICAgICBjb25zdCBlbGFwc2VkID0gbmV3IERhdGUoKSAtIHN0YXJ0XHJcbiAgICAgICAgY29uc3QgZXRhID0gcGVyY2VudCA9PT0gMTAwID8gMCA6IGVsYXBzZWQgKiAodG90YWwgLyBjdXJyIC0gMSlcclxuICAgICAgICBjb25zdCByYXRlID0gY3VyciAvIChlbGFwc2VkIC8gMTAwMClcclxuICAgICAgICBzdHJlYW0ud3JpdGUoXHJcbiAgICAgICAgICBgJHtvcHRpb25zLmZvcm1hdFxyXG4gICAgICAgICAgICAucmVwbGFjZSgnWzpiYXJdICcsICcnKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgnWzpiYXJdJywgJycpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKCc6Y3VycmVudCcsIGN1cnIpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKCc6dG90YWwnLCB0b3RhbClcclxuICAgICAgICAgICAgLnJlcGxhY2UoXHJcbiAgICAgICAgICAgICAgJzplbGFwc2VkJyxcclxuICAgICAgICAgICAgICBOdW1iZXIuaXNOYU4oZWxhcHNlZCkgPyAnMC4wJyA6IChlbGFwc2VkIC8gMTAwMCkudG9GaXhlZCgxKVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKFxyXG4gICAgICAgICAgICAgICc6ZXRhJyxcclxuICAgICAgICAgICAgICBOdW1iZXIuaXNOYU4oZXRhKSB8fCAhTnVtYmVyLmlzRmluaXRlKGV0YSlcclxuICAgICAgICAgICAgICAgID8gJzAuMCdcclxuICAgICAgICAgICAgICAgIDogKGV0YSAvIDEwMDApLnRvRml4ZWQoMSlcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgnOnBlcmNlbnQnLCBgJHtwZXJjZW50LnRvRml4ZWQoMCl9JWApXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKCc6cmF0ZScsIE1hdGgucm91bmQocmF0ZSkpfVxcbmBcclxuICAgICAgICApXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgfVxyXG59XHJcbiJdfQ==