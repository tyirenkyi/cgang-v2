"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _fsExtra = _interopRequireDefault(require("fs-extra"));

var _chalk = _interopRequireDefault(require("chalk"));

var _path = _interopRequireDefault(require("path"));

var _gitPromise = _interopRequireDefault(require("git-promise"));

var _child_process = require("child_process");

var _inquirer = _interopRequireDefault(require("inquirer"));

var _inquirerAutocompletePrompt = _interopRequireDefault(require("inquirer-autocomplete-prompt"));

var _matchSorter = _interopRequireDefault(require("match-sorter"));

var _downloadGitRepo = _interopRequireDefault(require("download-git-repo"));

var _util = require("util");

var _utils = require("../utils");

//
_inquirer["default"].registerPrompt('autocomplete', _inquirerAutocompletePrompt["default"]);

var typeLocal = 'Local Directory...';
var typeGit = 'GIT Repository...';
var typeExample = 'React Static Example';

var templatesDir = _path["default"].resolve(__dirname, '../../templates');

var templates = _fsExtra["default"].readdirSync(templatesDir).filter(function (d) {
  return !d.startsWith('.') && !d.startsWith('README');
});

var _default =
/*#__PURE__*/
function () {
  var _create = (0, _asyncToGenerator2["default"])(
  /*#__PURE__*/
  _regenerator["default"].mark(function _callee2(_ref) {
    var name, template, isCLI, isYarn, exampleChoices, templateType, answers, dest, _answers, _ref2, localDirectory, _ref3, githubRepoName, getGitHubRepo;

    return _regenerator["default"].wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            name = _ref.name, template = _ref.template, isCLI = _ref.isCLI;
            isYarn = shouldUseYarn();
            console.log('');
            exampleChoices = [].concat((0, _toConsumableArray2["default"])(templates), [typeLocal, typeGit]);
            templateType = typeExample; // prompt if --name argument is not passed from CLI
            // warning: since name will be set as a function by commander by default
            //   unless it's assigned as an argument from the CLI, we can't simply just
            //   check for its existence. if it has not been set by the CLI, we properly
            //   set it to null for later conditional checks.

            if (!(isCLI && !name)) {
              _context2.next = 10;
              break;
            }

            _context2.next = 8;
            return _inquirer["default"].prompt({
              type: 'input',
              name: 'name',
              message: 'What should we name this project?',
              "default": 'my-static-site'
            });

          case 8:
            answers = _context2.sent;
            name = answers.name;

          case 10:
            if (name) {
              _context2.next = 12;
              break;
            }

            throw new Error('A project name is required. Please use options.name to define one.');

          case 12:
            dest = _path["default"].resolve(process.cwd(), name);

            if (!_fsExtra["default"].existsSync(dest)) {
              _context2.next = 15;
              break;
            }

            throw new Error("Could not create project. Directory already exists at ".concat(dest, "!"));

          case 15:
            if (!(isCLI && !template)) {
              _context2.next = 20;
              break;
            }

            _context2.next = 18;
            return _inquirer["default"].prompt({
              type: 'autocomplete',
              name: 'template',
              message: 'Select a template below...',
              source: function () {
                var _source = (0, _asyncToGenerator2["default"])(
                /*#__PURE__*/
                _regenerator["default"].mark(function _callee(answersSoFar, input) {
                  return _regenerator["default"].wrap(function _callee$(_context) {
                    while (1) {
                      switch (_context.prev = _context.next) {
                        case 0:
                          return _context.abrupt("return", !input ? exampleChoices : (0, _matchSorter["default"])(exampleChoices, input));

                        case 1:
                        case "end":
                          return _context.stop();
                      }
                    }
                  }, _callee);
                }));

                function source(_x2, _x3) {
                  return _source.apply(this, arguments);
                }

                return source;
              }()
            });

          case 18:
            _answers = _context2.sent;
            template = _answers.template;

          case 20:
            if (template) {
              _context2.next = 22;
              break;
            }

            throw new Error('A project template is required. Please use options.template to define one.');

          case 22:
            (0, _utils.time)(_chalk["default"].green("[\u2713] Project \"".concat(name, "\" created")));
            console.log('Creating new react-static project...');

            if (!(template === typeLocal)) {
              _context2.next = 31;
              break;
            }

            templateType = typeLocal;
            _context2.next = 28;
            return _inquirer["default"].prompt([{
              type: 'input',
              name: 'localDirectory',
              message: "Enter an local directory's absolute location (~/Desktop/my-template)"
            }]);

          case 28:
            _ref2 = _context2.sent;
            localDirectory = _ref2.localDirectory;
            template = localDirectory;

          case 31:
            if (!(template === typeGit)) {
              _context2.next = 38;
              break;
            }

            templateType = typeGit;
            _context2.next = 35;
            return _inquirer["default"].prompt([{
              type: 'input',
              name: 'githubRepoName',
              message: 'Enter a repository URL from GitHub, BitBucket, GitLab, or any other public repo. (https://github.com/ownerName/repoName.git)'
            }]);

          case 35:
            _ref3 = _context2.sent;
            githubRepoName = _ref3.githubRepoName;
            template = githubRepoName;

          case 38:
            console.log(''); // GIT repositories

            if (!(templateType === typeGit)) {
              _context2.next = 67;
              break;
            }

            if (!(template.startsWith('https://') || template.startsWith('git@'))) {
              _context2.next = 53;
              break;
            }

            _context2.prev = 41;
            console.log(_chalk["default"].green("Cloning Git template: ".concat(template)));
            _context2.next = 45;
            return (0, _gitPromise["default"])("clone --recursive ".concat(template, " ").concat(dest));

          case 45:
            _context2.next = 51;
            break;

          case 47:
            _context2.prev = 47;
            _context2.t0 = _context2["catch"](41);
            console.log(_chalk["default"].red("Cloning Git template: ".concat(template, " failed!")));
            throw _context2.t0;

          case 51:
            _context2.next = 65;
            break;

          case 53:
            if (!template.startsWith('http://')) {
              _context2.next = 65;
              break;
            }

            // use download-git-repo to fetch remote repository
            getGitHubRepo = (0, _util.promisify)(_downloadGitRepo["default"]);
            _context2.prev = 55;
            console.log(_chalk["default"].green("Cloning Git template: ".concat(template)));
            _context2.next = 59;
            return getGitHubRepo(template, dest);

          case 59:
            _context2.next = 65;
            break;

          case 61:
            _context2.prev = 61;
            _context2.t1 = _context2["catch"](55);
            console.log(_chalk["default"].red("Cloning Git template: ".concat(template, " failed!")));
            throw _context2.t1;

          case 65:
            _context2.next = 90;
            break;

          case 67:
            if (!(templateType === typeExample)) {
              _context2.next = 80;
              break;
            }

            // React Static templates
            console.log(_chalk["default"].green("Using React Static template: ".concat(template)));
            _context2.prev = 69;
            _context2.next = 72;
            return _fsExtra["default"].copy(_path["default"].resolve(templatesDir, template), _path["default"].resolve(process.cwd(), dest));

          case 72:
            _context2.next = 78;
            break;

          case 74:
            _context2.prev = 74;
            _context2.t2 = _context2["catch"](69);
            console.log(_chalk["default"].red("Copying React Static template: ".concat(template, " failed!")));
            throw _context2.t2;

          case 78:
            _context2.next = 90;
            break;

          case 80:
            _context2.prev = 80;
            console.log(_chalk["default"].green("Using template from directory: ".concat(template)));
            _context2.next = 84;
            return _fsExtra["default"].copy(_path["default"].resolve(process.cwd(), template), dest);

          case 84:
            _context2.next = 90;
            break;

          case 86:
            _context2.prev = 86;
            _context2.t3 = _context2["catch"](80);
            console.log(_chalk["default"].red("Copying the template from directory: ".concat(template, " failed!")));
            throw _context2.t3;

          case 90:
            if (!(!_fsExtra["default"].pathExistsSync(_path["default"].join(dest, '.gitignore')) && _fsExtra["default"].pathExistsSync(_path["default"].join(dest, 'gitignore')))) {
              _context2.next = 93;
              break;
            }

            _context2.next = 93;
            return _fsExtra["default"].move(_path["default"].join(dest, 'gitignore'), _path["default"].join(dest, '.gitignore'));

          case 93:
            if (_fsExtra["default"].pathExistsSync(_path["default"].join(dest, 'gitignore'))) {
              _fsExtra["default"].removeSync(_path["default"].join(dest, 'gitignore'));
            }

            if (isCLI) {
              console.log("Installing dependencies with: ".concat(isYarn ? _chalk["default"].hex(_utils.ChalkColor.yarn)('Yarn') : _chalk["default"].hex(_utils.ChalkColor.npm)('NPM'), "...")); // We install react-static separately to ensure we always have the latest stable release

              (0, _child_process.execSync)("cd \"".concat(name, "\" && ").concat(isYarn ? 'yarn' : 'npm install'));
              console.log('');
            }

            (0, _utils.timeEnd)(_chalk["default"].green("[\u2713] Project \"".concat(name, "\" created")));
            console.log("\n  ".concat(_chalk["default"].green('To get started:'), "\n\n    cd \"").concat(name, "\" ").concat(!isCLI ? "&& ".concat(isYarn ? _chalk["default"].hex(_utils.ChalkColor.yarn)('yarn') : _chalk["default"].hex(_utils.ChalkColor.npm)('npm install')) : '', "\n\n    ").concat(isYarn ? _chalk["default"].hex(_utils.ChalkColor.yarn)('yarn') : _chalk["default"].hex(_utils.ChalkColor.npm)('npm run'), " start ").concat(_chalk["default"].green('- Start the development server'), "\n    ").concat(isYarn ? _chalk["default"].hex(_utils.ChalkColor.yarn)('yarn') : _chalk["default"].hex(_utils.ChalkColor.npm)('npm run'), " build ").concat(_chalk["default"].green('- Build for production'), "\n    ").concat(isYarn ? _chalk["default"].hex(_utils.ChalkColor.yarn)('yarn') : _chalk["default"].hex(_utils.ChalkColor.npm)('npm run'), " serve ").concat(_chalk["default"].green('- Test a production build locally'), "\n  "));

          case 97:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2, null, [[41, 47], [55, 61], [69, 74], [80, 86]]);
  }));

  function create(_x) {
    return _create.apply(this, arguments);
  }

  return create;
}();

exports["default"] = _default;

function shouldUseYarn() {
  try {
    (0, _child_process.execSync)('yarnpkg --version', {
      stdio: 'ignore'
    });
    return true;
  } catch (e) {
    return false;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tYW5kcy9jcmVhdGUuanMiXSwibmFtZXMiOlsiaW5xdWlyZXIiLCJyZWdpc3RlclByb21wdCIsImF1dG9Db21wbGV0ZVByb21wdCIsInR5cGVMb2NhbCIsInR5cGVHaXQiLCJ0eXBlRXhhbXBsZSIsInRlbXBsYXRlc0RpciIsInBhdGgiLCJyZXNvbHZlIiwiX19kaXJuYW1lIiwidGVtcGxhdGVzIiwiZnMiLCJyZWFkZGlyU3luYyIsImZpbHRlciIsImQiLCJzdGFydHNXaXRoIiwibmFtZSIsInRlbXBsYXRlIiwiaXNDTEkiLCJpc1lhcm4iLCJzaG91bGRVc2VZYXJuIiwiY29uc29sZSIsImxvZyIsImV4YW1wbGVDaG9pY2VzIiwidGVtcGxhdGVUeXBlIiwicHJvbXB0IiwidHlwZSIsIm1lc3NhZ2UiLCJhbnN3ZXJzIiwiRXJyb3IiLCJkZXN0IiwicHJvY2VzcyIsImN3ZCIsImV4aXN0c1N5bmMiLCJzb3VyY2UiLCJhbnN3ZXJzU29GYXIiLCJpbnB1dCIsImNoYWxrIiwiZ3JlZW4iLCJsb2NhbERpcmVjdG9yeSIsImdpdGh1YlJlcG9OYW1lIiwicmVkIiwiZ2V0R2l0SHViUmVwbyIsImRvd25sb2FkR2l0UmVwbyIsImNvcHkiLCJwYXRoRXhpc3RzU3luYyIsImpvaW4iLCJtb3ZlIiwicmVtb3ZlU3luYyIsImhleCIsIkNoYWxrQ29sb3IiLCJ5YXJuIiwibnBtIiwiY3JlYXRlIiwic3RkaW8iLCJlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFEQTtBQUdBQSxxQkFBU0MsY0FBVCxDQUF3QixjQUF4QixFQUF3Q0Msc0NBQXhDOztBQUVBLElBQU1DLFNBQVMsR0FBRyxvQkFBbEI7QUFDQSxJQUFNQyxPQUFPLEdBQUcsbUJBQWhCO0FBQ0EsSUFBTUMsV0FBVyxHQUFHLHNCQUFwQjs7QUFFQSxJQUFNQyxZQUFZLEdBQUdDLGlCQUFLQyxPQUFMLENBQWFDLFNBQWIsRUFBd0IsaUJBQXhCLENBQXJCOztBQUVBLElBQU1DLFNBQVMsR0FBR0Msb0JBQ2ZDLFdBRGUsQ0FDSE4sWUFERyxFQUVmTyxNQUZlLENBRVIsVUFBQUMsQ0FBQztBQUFBLFNBQUksQ0FBQ0EsQ0FBQyxDQUFDQyxVQUFGLENBQWEsR0FBYixDQUFELElBQXNCLENBQUNELENBQUMsQ0FBQ0MsVUFBRixDQUFhLFFBQWIsQ0FBM0I7QUFBQSxDQUZPLENBQWxCOzs7Ozs7OytCQUlnQjtBQUFBOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQXdCQyxZQUFBQSxJQUF4QixRQUF3QkEsSUFBeEIsRUFBOEJDLFFBQTlCLFFBQThCQSxRQUE5QixFQUF3Q0MsS0FBeEMsUUFBd0NBLEtBQXhDO0FBQ1JDLFlBQUFBLE1BRFEsR0FDQ0MsYUFBYSxFQURkO0FBR2RDLFlBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLEVBQVo7QUFFTUMsWUFBQUEsY0FMUSxpREFLYWIsU0FMYixJQUt3QlAsU0FMeEIsRUFLbUNDLE9BTG5DO0FBT1ZvQixZQUFBQSxZQVBVLEdBT0tuQixXQVBMLEVBU2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFiYyxrQkFjVmEsS0FBSyxJQUFJLENBQUNGLElBZEE7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQSxtQkFlVWhCLHFCQUFTeUIsTUFBVCxDQUFnQjtBQUNwQ0MsY0FBQUEsSUFBSSxFQUFFLE9BRDhCO0FBRXBDVixjQUFBQSxJQUFJLEVBQUUsTUFGOEI7QUFHcENXLGNBQUFBLE9BQU8sRUFBRSxtQ0FIMkI7QUFJcEMseUJBQVM7QUFKMkIsYUFBaEIsQ0FmVjs7QUFBQTtBQWVOQyxZQUFBQSxPQWZNO0FBcUJaWixZQUFBQSxJQUFJLEdBQUdZLE9BQU8sQ0FBQ1osSUFBZjs7QUFyQlk7QUFBQSxnQkF3QlRBLElBeEJTO0FBQUE7QUFBQTtBQUFBOztBQUFBLGtCQXlCTixJQUFJYSxLQUFKLENBQ0osb0VBREksQ0F6Qk07O0FBQUE7QUE4QlJDLFlBQUFBLElBOUJRLEdBOEJEdkIsaUJBQUtDLE9BQUwsQ0FBYXVCLE9BQU8sQ0FBQ0MsR0FBUixFQUFiLEVBQTRCaEIsSUFBNUIsQ0E5QkM7O0FBQUEsaUJBZ0NWTCxvQkFBR3NCLFVBQUgsQ0FBY0gsSUFBZCxDQWhDVTtBQUFBO0FBQUE7QUFBQTs7QUFBQSxrQkFpQ04sSUFBSUQsS0FBSixpRUFDcURDLElBRHJELE9BakNNOztBQUFBO0FBQUEsa0JBc0NWWixLQUFLLElBQUksQ0FBQ0QsUUF0Q0E7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQSxtQkF1Q1VqQixxQkFBU3lCLE1BQVQsQ0FBZ0I7QUFDcENDLGNBQUFBLElBQUksRUFBRSxjQUQ4QjtBQUVwQ1YsY0FBQUEsSUFBSSxFQUFFLFVBRjhCO0FBR3BDVyxjQUFBQSxPQUFPLEVBQUUsNEJBSDJCO0FBSXBDTyxjQUFBQSxNQUFNO0FBQUE7QUFBQTtBQUFBLDZDQUFFLGlCQUFPQyxZQUFQLEVBQXFCQyxLQUFyQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsMkRBQ04sQ0FBQ0EsS0FBRCxHQUFTYixjQUFULEdBQTBCLDZCQUFZQSxjQUFaLEVBQTRCYSxLQUE1QixDQURwQjs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxpQkFBRjs7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQTtBQUo4QixhQUFoQixDQXZDVjs7QUFBQTtBQXVDTlIsWUFBQUEsUUF2Q007QUE4Q1pYLFlBQUFBLFFBQVEsR0FBR1csUUFBTyxDQUFDWCxRQUFuQjs7QUE5Q1k7QUFBQSxnQkFpRFRBLFFBakRTO0FBQUE7QUFBQTtBQUFBOztBQUFBLGtCQWtETixJQUFJWSxLQUFKLENBQ0osNEVBREksQ0FsRE07O0FBQUE7QUF1RGQsNkJBQUtRLGtCQUFNQyxLQUFOLDhCQUFpQ3RCLElBQWpDLGdCQUFMO0FBQ0FLLFlBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLHNDQUFaOztBQXhEYyxrQkEwRFZMLFFBQVEsS0FBS2QsU0ExREg7QUFBQTtBQUFBO0FBQUE7O0FBMkRacUIsWUFBQUEsWUFBWSxHQUFHckIsU0FBZjtBQTNEWTtBQUFBLG1CQTREcUJILHFCQUFTeUIsTUFBVCxDQUFnQixDQUMvQztBQUNFQyxjQUFBQSxJQUFJLEVBQUUsT0FEUjtBQUVFVixjQUFBQSxJQUFJLEVBQUUsZ0JBRlI7QUFHRVcsY0FBQUEsT0FBTztBQUhULGFBRCtDLENBQWhCLENBNURyQjs7QUFBQTtBQUFBO0FBNERKWSxZQUFBQSxjQTVESSxTQTRESkEsY0E1REk7QUFtRVp0QixZQUFBQSxRQUFRLEdBQUdzQixjQUFYOztBQW5FWTtBQUFBLGtCQXNFVnRCLFFBQVEsS0FBS2IsT0F0RUg7QUFBQTtBQUFBO0FBQUE7O0FBdUVab0IsWUFBQUEsWUFBWSxHQUFHcEIsT0FBZjtBQXZFWTtBQUFBLG1CQXdFcUJKLHFCQUFTeUIsTUFBVCxDQUFnQixDQUMvQztBQUNFQyxjQUFBQSxJQUFJLEVBQUUsT0FEUjtBQUVFVixjQUFBQSxJQUFJLEVBQUUsZ0JBRlI7QUFHRVcsY0FBQUEsT0FBTyxFQUNMO0FBSkosYUFEK0MsQ0FBaEIsQ0F4RXJCOztBQUFBO0FBQUE7QUF3RUphLFlBQUFBLGNBeEVJLFNBd0VKQSxjQXhFSTtBQWdGWnZCLFlBQUFBLFFBQVEsR0FBR3VCLGNBQVg7O0FBaEZZO0FBbUZkbkIsWUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksRUFBWixFQW5GYyxDQXFGZDs7QUFyRmMsa0JBc0ZWRSxZQUFZLEtBQUtwQixPQXRGUDtBQUFBO0FBQUE7QUFBQTs7QUFBQSxrQkF1RlJhLFFBQVEsQ0FBQ0YsVUFBVCxDQUFvQixVQUFwQixLQUFtQ0UsUUFBUSxDQUFDRixVQUFULENBQW9CLE1BQXBCLENBdkYzQjtBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQXlGUk0sWUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVllLGtCQUFNQyxLQUFOLGlDQUFxQ3JCLFFBQXJDLEVBQVo7QUF6RlE7QUFBQSxtQkEwRkYsd0RBQXlCQSxRQUF6QixjQUFxQ2EsSUFBckMsRUExRkU7O0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTtBQTRGUlQsWUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVllLGtCQUFNSSxHQUFOLGlDQUFtQ3hCLFFBQW5DLGNBQVo7QUE1RlE7O0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBQUEsaUJBK0ZEQSxRQUFRLENBQUNGLFVBQVQsQ0FBb0IsU0FBcEIsQ0EvRkM7QUFBQTtBQUFBO0FBQUE7O0FBZ0dWO0FBQ00yQixZQUFBQSxhQWpHSSxHQWlHWSxxQkFBVUMsMkJBQVYsQ0FqR1o7QUFBQTtBQW1HUnRCLFlBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZZSxrQkFBTUMsS0FBTixpQ0FBcUNyQixRQUFyQyxFQUFaO0FBbkdRO0FBQUEsbUJBb0dGeUIsYUFBYSxDQUFDekIsUUFBRCxFQUFXYSxJQUFYLENBcEdYOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUE7QUFzR1JULFlBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZZSxrQkFBTUksR0FBTixpQ0FBbUN4QixRQUFuQyxjQUFaO0FBdEdROztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBLGtCQTBHSE8sWUFBWSxLQUFLbkIsV0ExR2Q7QUFBQTtBQUFBO0FBQUE7O0FBMkdaO0FBQ0FnQixZQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWWUsa0JBQU1DLEtBQU4sd0NBQTRDckIsUUFBNUMsRUFBWjtBQTVHWTtBQUFBO0FBQUEsbUJBOEdKTixvQkFBR2lDLElBQUgsQ0FDSnJDLGlCQUFLQyxPQUFMLENBQWFGLFlBQWIsRUFBMkJXLFFBQTNCLENBREksRUFFSlYsaUJBQUtDLE9BQUwsQ0FBYXVCLE9BQU8sQ0FBQ0MsR0FBUixFQUFiLEVBQTRCRixJQUE1QixDQUZJLENBOUdJOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUE7QUFtSFZULFlBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUNFZSxrQkFBTUksR0FBTiwwQ0FBNEN4QixRQUE1QyxjQURGO0FBbkhVOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBMkhWSSxZQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWWUsa0JBQU1DLEtBQU4sMENBQThDckIsUUFBOUMsRUFBWjtBQTNIVTtBQUFBLG1CQTRISk4sb0JBQUdpQyxJQUFILENBQVFyQyxpQkFBS0MsT0FBTCxDQUFhdUIsT0FBTyxDQUFDQyxHQUFSLEVBQWIsRUFBNEJmLFFBQTVCLENBQVIsRUFBK0NhLElBQS9DLENBNUhJOztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBO0FBQUE7QUE4SFZULFlBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUNFZSxrQkFBTUksR0FBTixnREFBa0R4QixRQUFsRCxjQURGO0FBOUhVOztBQUFBO0FBQUEsa0JBMElaLENBQUNOLG9CQUFHa0MsY0FBSCxDQUFrQnRDLGlCQUFLdUMsSUFBTCxDQUFVaEIsSUFBVixFQUFnQixZQUFoQixDQUFsQixDQUFELElBQ0FuQixvQkFBR2tDLGNBQUgsQ0FBa0J0QyxpQkFBS3VDLElBQUwsQ0FBVWhCLElBQVYsRUFBZ0IsV0FBaEIsQ0FBbEIsQ0EzSVk7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQSxtQkE2SU5uQixvQkFBR29DLElBQUgsQ0FBUXhDLGlCQUFLdUMsSUFBTCxDQUFVaEIsSUFBVixFQUFnQixXQUFoQixDQUFSLEVBQXNDdkIsaUJBQUt1QyxJQUFMLENBQVVoQixJQUFWLEVBQWdCLFlBQWhCLENBQXRDLENBN0lNOztBQUFBO0FBK0lkLGdCQUFJbkIsb0JBQUdrQyxjQUFILENBQWtCdEMsaUJBQUt1QyxJQUFMLENBQVVoQixJQUFWLEVBQWdCLFdBQWhCLENBQWxCLENBQUosRUFBcUQ7QUFDbkRuQixrQ0FBR3FDLFVBQUgsQ0FBY3pDLGlCQUFLdUMsSUFBTCxDQUFVaEIsSUFBVixFQUFnQixXQUFoQixDQUFkO0FBQ0Q7O0FBRUQsZ0JBQUlaLEtBQUosRUFBVztBQUNURyxjQUFBQSxPQUFPLENBQUNDLEdBQVIseUNBRUlILE1BQU0sR0FDRmtCLGtCQUFNWSxHQUFOLENBQVVDLGtCQUFXQyxJQUFyQixFQUEyQixNQUEzQixDQURFLEdBRUZkLGtCQUFNWSxHQUFOLENBQVVDLGtCQUFXRSxHQUFyQixFQUEwQixLQUExQixDQUpSLFVBRFMsQ0FRVDs7QUFDQSwwREFBZ0JwQyxJQUFoQixtQkFBNEJHLE1BQU0sR0FBRyxNQUFILEdBQVksYUFBOUM7QUFDQUUsY0FBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksRUFBWjtBQUNEOztBQUVELGdDQUFRZSxrQkFBTUMsS0FBTiw4QkFBaUN0QixJQUFqQyxnQkFBUjtBQUVBSyxZQUFBQSxPQUFPLENBQUNDLEdBQVIsZUFDRWUsa0JBQU1DLEtBQU4sQ0FBWSxpQkFBWixDQURGLDBCQUdRdEIsSUFIUixnQkFJRSxDQUFDRSxLQUFELGdCQUVNQyxNQUFNLEdBQ0ZrQixrQkFBTVksR0FBTixDQUFVQyxrQkFBV0MsSUFBckIsRUFBMkIsTUFBM0IsQ0FERSxHQUVGZCxrQkFBTVksR0FBTixDQUFVQyxrQkFBV0UsR0FBckIsRUFBMEIsYUFBMUIsQ0FKVixJQU1JLEVBVk4scUJBY0lqQyxNQUFNLEdBQ0ZrQixrQkFBTVksR0FBTixDQUFVQyxrQkFBV0MsSUFBckIsRUFBMkIsTUFBM0IsQ0FERSxHQUVGZCxrQkFBTVksR0FBTixDQUFVQyxrQkFBV0UsR0FBckIsRUFBMEIsU0FBMUIsQ0FoQlIsb0JBaUJZZixrQkFBTUMsS0FBTixDQUFZLGdDQUFaLENBakJaLG1CQW1CSW5CLE1BQU0sR0FDRmtCLGtCQUFNWSxHQUFOLENBQVVDLGtCQUFXQyxJQUFyQixFQUEyQixNQUEzQixDQURFLEdBRUZkLGtCQUFNWSxHQUFOLENBQVVDLGtCQUFXRSxHQUFyQixFQUEwQixTQUExQixDQXJCUixvQkFzQllmLGtCQUFNQyxLQUFOLENBQVksd0JBQVosQ0F0QlosbUJBd0JJbkIsTUFBTSxHQUNGa0Isa0JBQU1ZLEdBQU4sQ0FBVUMsa0JBQVdDLElBQXJCLEVBQTJCLE1BQTNCLENBREUsR0FFRmQsa0JBQU1ZLEdBQU4sQ0FBVUMsa0JBQVdFLEdBQXJCLEVBQTBCLFNBQTFCLENBMUJSLG9CQTJCWWYsa0JBQU1DLEtBQU4sQ0FBWSxtQ0FBWixDQTNCWjs7QUFsS2M7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRzs7V0FBZWUsTTs7OztTQUFBQSxNOzs7OztBQWlNL0IsU0FBU2pDLGFBQVQsR0FBeUI7QUFDdkIsTUFBSTtBQUNGLGlDQUFTLG1CQUFULEVBQThCO0FBQUVrQyxNQUFBQSxLQUFLLEVBQUU7QUFBVCxLQUE5QjtBQUNBLFdBQU8sSUFBUDtBQUNELEdBSEQsQ0FHRSxPQUFPQyxDQUFQLEVBQVU7QUFDVixXQUFPLEtBQVA7QUFDRDtBQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gJ2ZzLWV4dHJhJ1xyXG5pbXBvcnQgY2hhbGsgZnJvbSAnY2hhbGsnXHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXHJcbmltcG9ydCBnaXQgZnJvbSAnZ2l0LXByb21pc2UnXHJcbmltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2VzcydcclxuaW1wb3J0IGlucXVpcmVyIGZyb20gJ2lucXVpcmVyJ1xyXG5pbXBvcnQgYXV0b0NvbXBsZXRlUHJvbXB0IGZyb20gJ2lucXVpcmVyLWF1dG9jb21wbGV0ZS1wcm9tcHQnXHJcbmltcG9ydCBtYXRjaFNvcnRlciBmcm9tICdtYXRjaC1zb3J0ZXInXHJcbmltcG9ydCBkb3dubG9hZEdpdFJlcG8gZnJvbSAnZG93bmxvYWQtZ2l0LXJlcG8nXHJcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gJ3V0aWwnXHJcbi8vXHJcbmltcG9ydCB7IENoYWxrQ29sb3IsIHRpbWUsIHRpbWVFbmQgfSBmcm9tICcuLi91dGlscydcclxuXHJcbmlucXVpcmVyLnJlZ2lzdGVyUHJvbXB0KCdhdXRvY29tcGxldGUnLCBhdXRvQ29tcGxldGVQcm9tcHQpXHJcblxyXG5jb25zdCB0eXBlTG9jYWwgPSAnTG9jYWwgRGlyZWN0b3J5Li4uJ1xyXG5jb25zdCB0eXBlR2l0ID0gJ0dJVCBSZXBvc2l0b3J5Li4uJ1xyXG5jb25zdCB0eXBlRXhhbXBsZSA9ICdSZWFjdCBTdGF0aWMgRXhhbXBsZSdcclxuXHJcbmNvbnN0IHRlbXBsYXRlc0RpciA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLi8uLi90ZW1wbGF0ZXMnKVxyXG5cclxuY29uc3QgdGVtcGxhdGVzID0gZnNcclxuICAucmVhZGRpclN5bmModGVtcGxhdGVzRGlyKVxyXG4gIC5maWx0ZXIoZCA9PiAhZC5zdGFydHNXaXRoKCcuJykgJiYgIWQuc3RhcnRzV2l0aCgnUkVBRE1FJykpXHJcblxyXG5leHBvcnQgZGVmYXVsdCAoYXN5bmMgZnVuY3Rpb24gY3JlYXRlKHsgbmFtZSwgdGVtcGxhdGUsIGlzQ0xJIH0pIHtcclxuICBjb25zdCBpc1lhcm4gPSBzaG91bGRVc2VZYXJuKClcclxuXHJcbiAgY29uc29sZS5sb2coJycpXHJcblxyXG4gIGNvbnN0IGV4YW1wbGVDaG9pY2VzID0gWy4uLnRlbXBsYXRlcywgdHlwZUxvY2FsLCB0eXBlR2l0XVxyXG5cclxuICBsZXQgdGVtcGxhdGVUeXBlID0gdHlwZUV4YW1wbGVcclxuXHJcbiAgLy8gcHJvbXB0IGlmIC0tbmFtZSBhcmd1bWVudCBpcyBub3QgcGFzc2VkIGZyb20gQ0xJXHJcbiAgLy8gd2FybmluZzogc2luY2UgbmFtZSB3aWxsIGJlIHNldCBhcyBhIGZ1bmN0aW9uIGJ5IGNvbW1hbmRlciBieSBkZWZhdWx0XHJcbiAgLy8gICB1bmxlc3MgaXQncyBhc3NpZ25lZCBhcyBhbiBhcmd1bWVudCBmcm9tIHRoZSBDTEksIHdlIGNhbid0IHNpbXBseSBqdXN0XHJcbiAgLy8gICBjaGVjayBmb3IgaXRzIGV4aXN0ZW5jZS4gaWYgaXQgaGFzIG5vdCBiZWVuIHNldCBieSB0aGUgQ0xJLCB3ZSBwcm9wZXJseVxyXG4gIC8vICAgc2V0IGl0IHRvIG51bGwgZm9yIGxhdGVyIGNvbmRpdGlvbmFsIGNoZWNrcy5cclxuICBpZiAoaXNDTEkgJiYgIW5hbWUpIHtcclxuICAgIGNvbnN0IGFuc3dlcnMgPSBhd2FpdCBpbnF1aXJlci5wcm9tcHQoe1xyXG4gICAgICB0eXBlOiAnaW5wdXQnLFxyXG4gICAgICBuYW1lOiAnbmFtZScsXHJcbiAgICAgIG1lc3NhZ2U6ICdXaGF0IHNob3VsZCB3ZSBuYW1lIHRoaXMgcHJvamVjdD8nLFxyXG4gICAgICBkZWZhdWx0OiAnbXktc3RhdGljLXNpdGUnLFxyXG4gICAgfSlcclxuICAgIG5hbWUgPSBhbnN3ZXJzLm5hbWVcclxuICB9XHJcblxyXG4gIGlmICghbmFtZSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAnQSBwcm9qZWN0IG5hbWUgaXMgcmVxdWlyZWQuIFBsZWFzZSB1c2Ugb3B0aW9ucy5uYW1lIHRvIGRlZmluZSBvbmUuJ1xyXG4gICAgKVxyXG4gIH1cclxuXHJcbiAgY29uc3QgZGVzdCA9IHBhdGgucmVzb2x2ZShwcm9jZXNzLmN3ZCgpLCBuYW1lKVxyXG5cclxuICBpZiAoZnMuZXhpc3RzU3luYyhkZXN0KSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICBgQ291bGQgbm90IGNyZWF0ZSBwcm9qZWN0LiBEaXJlY3RvcnkgYWxyZWFkeSBleGlzdHMgYXQgJHtkZXN0fSFgXHJcbiAgICApXHJcbiAgfVxyXG5cclxuICBpZiAoaXNDTEkgJiYgIXRlbXBsYXRlKSB7XHJcbiAgICBjb25zdCBhbnN3ZXJzID0gYXdhaXQgaW5xdWlyZXIucHJvbXB0KHtcclxuICAgICAgdHlwZTogJ2F1dG9jb21wbGV0ZScsXHJcbiAgICAgIG5hbWU6ICd0ZW1wbGF0ZScsXHJcbiAgICAgIG1lc3NhZ2U6ICdTZWxlY3QgYSB0ZW1wbGF0ZSBiZWxvdy4uLicsXHJcbiAgICAgIHNvdXJjZTogYXN5bmMgKGFuc3dlcnNTb0ZhciwgaW5wdXQpID0+XHJcbiAgICAgICAgIWlucHV0ID8gZXhhbXBsZUNob2ljZXMgOiBtYXRjaFNvcnRlcihleGFtcGxlQ2hvaWNlcywgaW5wdXQpLFxyXG4gICAgfSlcclxuICAgIHRlbXBsYXRlID0gYW5zd2Vycy50ZW1wbGF0ZVxyXG4gIH1cclxuXHJcbiAgaWYgKCF0ZW1wbGF0ZSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAnQSBwcm9qZWN0IHRlbXBsYXRlIGlzIHJlcXVpcmVkLiBQbGVhc2UgdXNlIG9wdGlvbnMudGVtcGxhdGUgdG8gZGVmaW5lIG9uZS4nXHJcbiAgICApXHJcbiAgfVxyXG5cclxuICB0aW1lKGNoYWxrLmdyZWVuKGBbXFx1MjcxM10gUHJvamVjdCBcIiR7bmFtZX1cIiBjcmVhdGVkYCkpXHJcbiAgY29uc29sZS5sb2coJ0NyZWF0aW5nIG5ldyByZWFjdC1zdGF0aWMgcHJvamVjdC4uLicpXHJcblxyXG4gIGlmICh0ZW1wbGF0ZSA9PT0gdHlwZUxvY2FsKSB7XHJcbiAgICB0ZW1wbGF0ZVR5cGUgPSB0eXBlTG9jYWxcclxuICAgIGNvbnN0IHsgbG9jYWxEaXJlY3RvcnkgfSA9IGF3YWl0IGlucXVpcmVyLnByb21wdChbXHJcbiAgICAgIHtcclxuICAgICAgICB0eXBlOiAnaW5wdXQnLFxyXG4gICAgICAgIG5hbWU6ICdsb2NhbERpcmVjdG9yeScsXHJcbiAgICAgICAgbWVzc2FnZTogYEVudGVyIGFuIGxvY2FsIGRpcmVjdG9yeSdzIGFic29sdXRlIGxvY2F0aW9uICh+L0Rlc2t0b3AvbXktdGVtcGxhdGUpYCxcclxuICAgICAgfSxcclxuICAgIF0pXHJcbiAgICB0ZW1wbGF0ZSA9IGxvY2FsRGlyZWN0b3J5XHJcbiAgfVxyXG5cclxuICBpZiAodGVtcGxhdGUgPT09IHR5cGVHaXQpIHtcclxuICAgIHRlbXBsYXRlVHlwZSA9IHR5cGVHaXRcclxuICAgIGNvbnN0IHsgZ2l0aHViUmVwb05hbWUgfSA9IGF3YWl0IGlucXVpcmVyLnByb21wdChbXHJcbiAgICAgIHtcclxuICAgICAgICB0eXBlOiAnaW5wdXQnLFxyXG4gICAgICAgIG5hbWU6ICdnaXRodWJSZXBvTmFtZScsXHJcbiAgICAgICAgbWVzc2FnZTpcclxuICAgICAgICAgICdFbnRlciBhIHJlcG9zaXRvcnkgVVJMIGZyb20gR2l0SHViLCBCaXRCdWNrZXQsIEdpdExhYiwgb3IgYW55IG90aGVyIHB1YmxpYyByZXBvLiAoaHR0cHM6Ly9naXRodWIuY29tL293bmVyTmFtZS9yZXBvTmFtZS5naXQpJyxcclxuICAgICAgfSxcclxuICAgIF0pXHJcbiAgICB0ZW1wbGF0ZSA9IGdpdGh1YlJlcG9OYW1lXHJcbiAgfVxyXG5cclxuICBjb25zb2xlLmxvZygnJylcclxuXHJcbiAgLy8gR0lUIHJlcG9zaXRvcmllc1xyXG4gIGlmICh0ZW1wbGF0ZVR5cGUgPT09IHR5cGVHaXQpIHtcclxuICAgIGlmICh0ZW1wbGF0ZS5zdGFydHNXaXRoKCdodHRwczovLycpIHx8IHRlbXBsYXRlLnN0YXJ0c1dpdGgoJ2dpdEAnKSkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGNoYWxrLmdyZWVuKGBDbG9uaW5nIEdpdCB0ZW1wbGF0ZTogJHt0ZW1wbGF0ZX1gKSlcclxuICAgICAgICBhd2FpdCBnaXQoYGNsb25lIC0tcmVjdXJzaXZlICR7dGVtcGxhdGV9ICR7ZGVzdH1gKVxyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5yZWQoYENsb25pbmcgR2l0IHRlbXBsYXRlOiAke3RlbXBsYXRlfSBmYWlsZWQhYCkpXHJcbiAgICAgICAgdGhyb3cgZXJyXHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAodGVtcGxhdGUuc3RhcnRzV2l0aCgnaHR0cDovLycpKSB7XHJcbiAgICAgIC8vIHVzZSBkb3dubG9hZC1naXQtcmVwbyB0byBmZXRjaCByZW1vdGUgcmVwb3NpdG9yeVxyXG4gICAgICBjb25zdCBnZXRHaXRIdWJSZXBvID0gcHJvbWlzaWZ5KGRvd25sb2FkR2l0UmVwbylcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5ncmVlbihgQ2xvbmluZyBHaXQgdGVtcGxhdGU6ICR7dGVtcGxhdGV9YCkpXHJcbiAgICAgICAgYXdhaXQgZ2V0R2l0SHViUmVwbyh0ZW1wbGF0ZSwgZGVzdClcclxuICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coY2hhbGsucmVkKGBDbG9uaW5nIEdpdCB0ZW1wbGF0ZTogJHt0ZW1wbGF0ZX0gZmFpbGVkIWApKVxyXG4gICAgICAgIHRocm93IGVyclxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSBlbHNlIGlmICh0ZW1wbGF0ZVR5cGUgPT09IHR5cGVFeGFtcGxlKSB7XHJcbiAgICAvLyBSZWFjdCBTdGF0aWMgdGVtcGxhdGVzXHJcbiAgICBjb25zb2xlLmxvZyhjaGFsay5ncmVlbihgVXNpbmcgUmVhY3QgU3RhdGljIHRlbXBsYXRlOiAke3RlbXBsYXRlfWApKVxyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgZnMuY29weShcclxuICAgICAgICBwYXRoLnJlc29sdmUodGVtcGxhdGVzRGlyLCB0ZW1wbGF0ZSksXHJcbiAgICAgICAgcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksIGRlc3QpXHJcbiAgICAgIClcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICBjaGFsay5yZWQoYENvcHlpbmcgUmVhY3QgU3RhdGljIHRlbXBsYXRlOiAke3RlbXBsYXRlfSBmYWlsZWQhYClcclxuICAgICAgKVxyXG4gICAgICB0aHJvdyBlcnJcclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgLy8gTG9jYWwgdGVtcGxhdGVzXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zb2xlLmxvZyhjaGFsay5ncmVlbihgVXNpbmcgdGVtcGxhdGUgZnJvbSBkaXJlY3Rvcnk6ICR7dGVtcGxhdGV9YCkpXHJcbiAgICAgIGF3YWl0IGZzLmNvcHkocGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksIHRlbXBsYXRlKSwgZGVzdClcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICBjaGFsay5yZWQoYENvcHlpbmcgdGhlIHRlbXBsYXRlIGZyb20gZGlyZWN0b3J5OiAke3RlbXBsYXRlfSBmYWlsZWQhYClcclxuICAgICAgKVxyXG4gICAgICB0aHJvdyBlcnJcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFNpbmNlIG5wbSBwYWNrYWdpbmcgd2lsbCBjbG9iYmVyIC5naXRpZ25vcmUgZmlsZXNcclxuICAvLyBXZSBuZWVkIHRvIHJlbmFtZSB0aGUgZ2l0aWdub3JlIGZpbGUgdG8gLmdpdGlnbm9yZVxyXG4gIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL25wbS9ucG0vaXNzdWVzLzE4NjJcclxuXHJcbiAgaWYgKFxyXG4gICAgIWZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbihkZXN0LCAnLmdpdGlnbm9yZScpKSAmJlxyXG4gICAgZnMucGF0aEV4aXN0c1N5bmMocGF0aC5qb2luKGRlc3QsICdnaXRpZ25vcmUnKSlcclxuICApIHtcclxuICAgIGF3YWl0IGZzLm1vdmUocGF0aC5qb2luKGRlc3QsICdnaXRpZ25vcmUnKSwgcGF0aC5qb2luKGRlc3QsICcuZ2l0aWdub3JlJykpXHJcbiAgfVxyXG4gIGlmIChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4oZGVzdCwgJ2dpdGlnbm9yZScpKSkge1xyXG4gICAgZnMucmVtb3ZlU3luYyhwYXRoLmpvaW4oZGVzdCwgJ2dpdGlnbm9yZScpKVxyXG4gIH1cclxuXHJcbiAgaWYgKGlzQ0xJKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcclxuICAgICAgYEluc3RhbGxpbmcgZGVwZW5kZW5jaWVzIHdpdGg6ICR7XHJcbiAgICAgICAgaXNZYXJuXHJcbiAgICAgICAgICA/IGNoYWxrLmhleChDaGFsa0NvbG9yLnlhcm4pKCdZYXJuJylcclxuICAgICAgICAgIDogY2hhbGsuaGV4KENoYWxrQ29sb3IubnBtKSgnTlBNJylcclxuICAgICAgfS4uLmBcclxuICAgIClcclxuICAgIC8vIFdlIGluc3RhbGwgcmVhY3Qtc3RhdGljIHNlcGFyYXRlbHkgdG8gZW5zdXJlIHdlIGFsd2F5cyBoYXZlIHRoZSBsYXRlc3Qgc3RhYmxlIHJlbGVhc2VcclxuICAgIGV4ZWNTeW5jKGBjZCBcIiR7bmFtZX1cIiAmJiAke2lzWWFybiA/ICd5YXJuJyA6ICducG0gaW5zdGFsbCd9YClcclxuICAgIGNvbnNvbGUubG9nKCcnKVxyXG4gIH1cclxuXHJcbiAgdGltZUVuZChjaGFsay5ncmVlbihgW1xcdTI3MTNdIFByb2plY3QgXCIke25hbWV9XCIgY3JlYXRlZGApKVxyXG5cclxuICBjb25zb2xlLmxvZyhgXHJcbiAgJHtjaGFsay5ncmVlbignVG8gZ2V0IHN0YXJ0ZWQ6Jyl9XHJcblxyXG4gICAgY2QgXCIke25hbWV9XCIgJHtcclxuICAgICFpc0NMSVxyXG4gICAgICA/IGAmJiAke1xyXG4gICAgICAgICAgaXNZYXJuXHJcbiAgICAgICAgICAgID8gY2hhbGsuaGV4KENoYWxrQ29sb3IueWFybikoJ3lhcm4nKVxyXG4gICAgICAgICAgICA6IGNoYWxrLmhleChDaGFsa0NvbG9yLm5wbSkoJ25wbSBpbnN0YWxsJylcclxuICAgICAgICB9YFxyXG4gICAgICA6ICcnXHJcbiAgfVxyXG5cclxuICAgICR7XHJcbiAgICAgIGlzWWFyblxyXG4gICAgICAgID8gY2hhbGsuaGV4KENoYWxrQ29sb3IueWFybikoJ3lhcm4nKVxyXG4gICAgICAgIDogY2hhbGsuaGV4KENoYWxrQ29sb3IubnBtKSgnbnBtIHJ1bicpXHJcbiAgICB9IHN0YXJ0ICR7Y2hhbGsuZ3JlZW4oJy0gU3RhcnQgdGhlIGRldmVsb3BtZW50IHNlcnZlcicpfVxyXG4gICAgJHtcclxuICAgICAgaXNZYXJuXHJcbiAgICAgICAgPyBjaGFsay5oZXgoQ2hhbGtDb2xvci55YXJuKSgneWFybicpXHJcbiAgICAgICAgOiBjaGFsay5oZXgoQ2hhbGtDb2xvci5ucG0pKCducG0gcnVuJylcclxuICAgIH0gYnVpbGQgJHtjaGFsay5ncmVlbignLSBCdWlsZCBmb3IgcHJvZHVjdGlvbicpfVxyXG4gICAgJHtcclxuICAgICAgaXNZYXJuXHJcbiAgICAgICAgPyBjaGFsay5oZXgoQ2hhbGtDb2xvci55YXJuKSgneWFybicpXHJcbiAgICAgICAgOiBjaGFsay5oZXgoQ2hhbGtDb2xvci5ucG0pKCducG0gcnVuJylcclxuICAgIH0gc2VydmUgJHtjaGFsay5ncmVlbignLSBUZXN0IGEgcHJvZHVjdGlvbiBidWlsZCBsb2NhbGx5Jyl9XHJcbiAgYClcclxufSlcclxuXHJcbmZ1bmN0aW9uIHNob3VsZFVzZVlhcm4oKSB7XHJcbiAgdHJ5IHtcclxuICAgIGV4ZWNTeW5jKCd5YXJucGtnIC0tdmVyc2lvbicsIHsgc3RkaW86ICdpZ25vcmUnIH0pXHJcbiAgICByZXR1cm4gdHJ1ZVxyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIHJldHVybiBmYWxzZVxyXG4gIH1cclxufVxyXG4iXX0=